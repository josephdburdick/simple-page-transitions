$(function(){"use strict";var e=function(){var e,t=$(window),o=$(document),n=($("body"),{stage:'[data-role="stage"]',page:'[data-role="page"]',pageContainerClass:".page-container",mainAreaID:"#page-current",prevAreaID:"#page-prev",nextAreaID:"#page-next"}),i={"":"index","/":"index",index:"index",work:"work",services:"services",about:"about",thoughts:"thoughts",contact:"contact"},a=function(e){return $(e).outerHeight(!0)+$(e).offset().top},p=function(e){return $(e).offset().top},s=function(o){e=$.extend({},n,o),T(),t.load(function(){t.scrollTop($("[data-page] .page-block").offset().top)})},r=function(){return window.location.hash.replace("#","")},d=function(e){e.off("click").on("click",function(e){e.preventDefault(),v({position:e.currentTarget.dataset.position,el:$(e.currentTarget)})})},l=function(e){return['<a href="#" data-role="speedbump" data-position="'+e.position+'" id="'+e.id+"-"+e.page+"-"+e.position+'" class="speedBump-container speedBump-'+e.position+'">','<div class="speedBump">LOADING...</div>',"</a>"].join("\n")},u=function(t){var o=null,n="speedBump",a=i[window.location.hash.replace("#","")],p=l({id:n,page:a,position:t}),s=$.parseHTML(p);return $("#"+$(s).attr("id")).length?(o=$("#"+$(s).attr("id")),d(o),o):("append"===t?$(e.stage).find('[data-page="'+a+'"]').append(p):$(e.stage).find('[data-page="'+a+'"]').prepend(p),o=$("#"+$(s).attr("id")),d(o),o)},c=function(t){var o=!1,n=new RSVP.Promise(function(n,i){$.get("about.html").done(function(i){var a=$(i),p=a.find(e.page)[0];o=!!p,i={loaded:o,pageName:a.find('[data-role="page"]').data("page"),$parsedPage:p,position:t.position},n(i)}).fail(function(e){var n={loaded:o,position:t.position,errorMsg:"Error: "+e.responseText};i(n)})});return n},g=function(e,t){e.visible?$(e.el).find(".speedBump").addClass("active"):$(e.el).find(".speedBump").removeClass("active"),t&&t()},f=function(e){e.page&&($(e.page).addClass("scene_element--fadeinup"),$("html, body").animate({scrollTop:$(e.page).offset().top},500))},h=function(e){var t=0;"preview"===e.type?t=$(e.el).offset().top-$(e.el).outerHeight(!0)/1.25:"half"===e.type?t=$(e.el).offset().top-$(e.el).outerHeight(!0)/2:"whole"===e.type&&(t=$(e.el).offset().top),$("html, body").animate({scrollTop:t},500)},m=function(){t.on("scroll",function(e){var n,i,a,p=Math.round($(this).scrollTop());Math.round($(this).innerHeight());0===p&&console.log("Reached beginning of page."),t.scrollTop()+t.height()>o.height()-60&&(console.log("Near end of page."),n="append",i=u(n)),t.scrollTop()+t.height()===o.height()&&(console.log("Reached end of page."),n="append",i=u(n),a=r(),v({page:a,position:n,el:i}))})},v=function(t){g({el:t.speedBumpEl,position:t.position,visible:!0},function(){setTimeout(function(){c({position:t.position}).then(function(o){window.location.hash=o.pageName,"append"===o.position?($(e.stage).append(o.$parsedPage),h({el:o.$parsedPage,position:o.position,type:"whole"})):$(e.stage).prepend(o.$parsedPage),g({el:t.speedBumpEl,position:o.position,visible:!1})},function(e){e.previousText=$(t.speedBumpEl).find(".speedBump").text(),g({el:t.speedBumpEl,position:e.position,visible:!0}),$(t.speedBumpEl).find(".speedBump").addClass("bg-danger text-danger").text(e.errorMsg),setTimeout(function(){g({el:t.speedBumpEl,position:e.position,visible:!1},function(){setTimeout(function(){$(t.speedBumpEl).find(".speedBump").removeClass("bg-danger text-danger").text(e.previousText)},2e3)})},2e3)})},2e3)})},T=function(){setTimeout(function(){t.on("scroll",m())},500),window.location.hash&&console.log("Current hash value: "+r())};return{init:s,triggerPageTransition:f,getURLHash:r,getHeightandOffset:a,distanceFromPageTop:p}}();e.init()});