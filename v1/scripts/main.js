$(function(){"use strict";var e=function(){var e,t=$(window),o=$(document),n=($("body"),{stage:'[data-role="stage"]',page:'[data-role="page"]',pageContainerClass:".page-container",mainAreaID:"#page-current",prevAreaID:"#page-prev",nextAreaID:"#page-next"}),i=function(e){return $(e).outerHeight(!0)+$(e).offset().top},a=function(e){return $(e).offset().top},p=function(e){return['<div class="speedBump-container speedBump-'+e.position+'" id="'+e.id+"-"+e.position+'">','<div class="speedBump">LOADING...</div>',"</div>"].join("\n")},s=function(t){var o=null,n="speedBump",i=p({id:n,position:t}),a=$.parseHTML(i);return $("#"+$(a).attr("id")).length?o=$("#"+$(a).attr("id")):("append"===t?$(e.stage).append(i):$(e.stage).prepend(i),o=$("#"+$(a).attr("id")))},r=function(t){var o=!1,n=new RSVP.Promise(function(n,i){$.get("about.html").done(function(i){var a=$(i),p=a.find(e.page)[0];o=!!p,i={loaded:o,$parsedPage:p,position:t.position},n(i)}).fail(function(e){var n={loaded:o,position:t.position,errorMsg:"Error: "+e.responseText};i(n)})});return n},d=function(e,t){e.visible?$(e.el).find(".speedBump").addClass("active"):$(e.el).find(".speedBump").removeClass("active"),t&&t()},l=function(e){"append"===e.position&&($(e.page).addClass("scene_element--fadeinup"),$("html, body").animate({scrollTop:$(e.page).offset().top/8},500))},u=function(e){var t=0;t="preview"===e.type?$(e.el).offset().top-$(e.el).outerHeight(!0)/1.25:$(e.el).offset().top+$(e.el).offset().top/4,$("html, body").animate({scrollTop:t},500)},f=function(){t.on("scroll",function(n){var i,a=Math.round($(this).scrollTop());Math.round($(this).innerHeight());if(0===a&&console.log("Reached beginning of page."),t.scrollTop()+t.height()>o.height()-60&&console.log("Near end of page."),t.scrollTop()+t.height()===o.height()){console.log("Reached end of page."),i="append";var p=s(i);d({el:p,position:i,visible:!0},function(){setTimeout(function(){r({position:i}).then(function(t){"append"===t.position?($(e.stage).append(t.$parsedPage),u({el:t.$parsedPage,position:t.position,type:"preview"})):$(e.stage).prepend(t.$parsedPage),d({el:p,position:t.position,visible:!1})},function(e){e.previousText=$(p).find(".speedBump").text(),d({el:p,position:e.position,visible:!0}),$(p).find(".speedBump").addClass("bg-danger text-danger").text(e.errorMsg),setTimeout(function(){d({el:p,position:e.position,visible:!1},function(){setTimeout(function(){$(p).find(".speedBump").removeClass("bg-danger text-danger").text(e.previousText)},2e3)})},2e3)})},2e3)})}})},g=function(){setTimeout(function(){t.on("scroll",f())},500)},c=function(o){e=$.extend({},n,o),g(),t.load(function(){t.scrollTop($("[data-page] .page-block").offset().top)})};return{init:c,triggerPageTransition:l,getHeightandOffset:i,distanceFromPageTop:a}}();e.init()});